{# repurposed zkill wheel https://github.com/zKillboard/zKillboard #}

{% extends 'alliancetools/base.html' %}
{% load static %}
{% load i18n %}
{% load humanize %}
{% load alliancetools_tags %}

{% block at_block %}
    {% if structure %}
    <div class="container col-sm-12">
        <div class="row justify-content-center">
            <div class="col-sm-12 col-md-12 text-center">
                <h3>{{structure.name}}</h3>
            </div>
        </br>
        </br>

        </div>
        <div class="row">
            <div class="col-sm-12 col-md-4 text-center">
                <div id="Fitting_Panel" style="position: relative; height:398px; width:398px; z-index: 3; margin: 0 auto;" >
                    <div id="mask" style="position:absolute; left: 0px; top: 0 px; width:398px; height:398px; z-index:-1;">
                        <img style="position:absolute; left: 0px; top: 0px;  height:398px; width:398px; border:0px" src="{% static 'alliancetools/img/pannel/tyrannis.png' %}" alt="" />
                    </div>

                    <div id="highx" style="position:absolute; left: 0px; top: 0px; width: 398px; height: 398px; z-index:-1;">
                        <img src="/static/alliancetools/img/pannel/{{ slots.high }}h.png" alt="" style="border:0px;" />
                    </div>
                    <div id="high1" style="position:absolute; left:73px; top:60px; width:32px; height:32px;">{{ fittings.HiSlot0.type_id|item_image|safe }}</div>
                    <div id="high2" style="position:absolute; left:102px; top:42px; width:32px; height:32px;">{{ fittings.HiSlot1.type_id|item_image|safe }}</div>
                    <div id="high3" style="position:absolute; left:134px; top:27px; width:32px; height:32px;">{{ fittings.HiSlot2.type_id|item_image|safe }}</div>
                    <div id="high4" style="position:absolute; left:169px; top:21px; width:32px; height:32px;">{{ fittings.HiSlot3.type_id|item_image|safe }}</div>
                    <div id="high5" style="position:absolute; left:203px; top:22px; width:32px; height:32px;">{{ fittings.HiSlot4.type_id|item_image|safe }}</div>
                    <div id="high6" style="position:absolute; left:238px; top:30px; width:32px; height:32px;">{{ fittings.HiSlot5.type_id|item_image|safe }}</div>
                    <div id="high7" style="position:absolute; left:270px; top:45px; width:32px; height:32px;">{{ fittings.HiSlot6.type_id|item_image|safe }}</div>
                    <div id="high8" style="position:absolute; left:295px; top:64px; width:32px; height:32px;">{{ fittings.HiSlot7.type_id|item_image|safe }}</div>

                    <div id="midx" style="position:absolute; left: 0px; top: 0px; width: 398px; height: 398px; z-index:-1;">
                        <img src="/static/alliancetools/img/pannel/{{ slots.med }}m.png" alt="" style="border:0px;" />
                    </div>
                    <div id="mid1" style="position:absolute; left:26px; top:140px; width:32px; height:32px;">{{ fittings.MedSlot0.type_id|item_image|safe }}</div>
                    <div id="mid2" style="position:absolute; left:24px; top:176px; width:32px; height:32px;">{{ fittings.MedSlot1.type_id|item_image|safe }}</div>
                    <div id="mid3" style="position:absolute; left:23px; top:212px; width:32px; height:32px;">{{ fittings.MedSlot2.type_id|item_image|safe }}</div>
                    <div id="mid4" style="position:absolute; left:30px; top:245px; width:32px; height:32px;">{{ fittings.MedSlot3.type_id|item_image|safe }}</div>
                    <div id="mid5" style="position:absolute; left:46px; top:278px; width:32px; height:32px;">{{ fittings.MedSlot4.type_id|item_image|safe }}</div>
                    <div id="mid6" style="position:absolute; left:69px; top:304px; width:32px; height:32px;">{{ fittings.MedSlot5.type_id|item_image|safe }}</div>
                    <div id="mid7" style="position:absolute; left:100px; top:328px; width:32px; height:32px;">{{ fittings.MedSlot6.type_id|item_image|safe }}</div>
                    <div id="mid8" style="position:absolute; left:133px; top:342px; width:32px; height:32px;">{{ fittings.MedSlot7.type_id|item_image|safe }}</div>

                    <div id="lowx" style="position:absolute; left: 0px; top: 0px; width: 398px; height: 398px; z-index:-1;">
                        <img src="/static/alliancetools/img/pannel/{{ slots.low }}l.png" alt="" style="border:0px;" />
                    </div>
                    <div id="low1" style="position:absolute; left:344px; top:143px; width:32px; height:32px;">{{ fittings.LoSlot0.type_id|item_image|safe }}</div>
                    <div id="low2" style="position:absolute; left:350px; top:178px; width:32px; height:32px;">{{ fittings.LoSlot1.type_id|item_image|safe }}</div>
                    <div id="low3" style="position:absolute; left:349px; top:213px; width:32px; height:32px;">{{ fittings.LoSlot2.type_id|item_image|safe }}</div>
                    <div id="low4" style="position:absolute; left:340px; top:246px; width:32px; height:32px;">{{ fittings.LoSlot3.type_id|item_image|safe }}</div>
                    <div id="low5" style="position:absolute; left:323px; top:277px; width:32px; height:32px;">{{ fittings.LoSlot4.type_id|item_image|safe }}</div>
                    <div id="low6" style="position:absolute; left:300px; top:304px; width:32px; height:32px;">{{ fittings.LoSlot5.type_id|item_image|safe }}</div>
                    <div id="low7" style="position:absolute; left:268px; top:324px; width:32px; height:32px;">{{ fittings.LoSlot6.type_id|item_image|safe }}</div>
                    <div id="low8" style="position:absolute; left:234px; top:338px; width:32px; height:32px;">{{ fittings.LoSlot7.type_id|item_image|safe }}</div>

                    <div id="rigxx" style="position:absolute; left: 0px; top: 0px; width: 398px; height: 398px; z-index:-1;">
                        <img src="/static/alliancetools/img/pannel/{{ slots.rig }}r.png" alt="" style="border:0px;" />
                    </div>
                    <div id="rig1" style="position:absolute; left:148px; top:259px; width:32px; height:32px;">{{ fittings.RigSlot0.type_id|item_image|safe }}</div>
                    <div id="rig2" style="position:absolute; left:185px; top:267px; width:32px; height:32px;">{{ fittings.RigSlot1.type_id|item_image|safe }}</div>
                    <div id="rig3" style="position:absolute; left:221px; top:259px; width:32px; height:32px;">{{ fittings.RigSlot2.type_id|item_image|safe }}</div>

                    <div id="subx" style="position:absolute; left: 0px; top: 0px; width: 398px; height: 398px; z-index:-1;">
                        <img src="/static/alliancetools/img/pannel/5s.png" alt="" style="border:0px;" />
                    </div>
                    <div id="sub1" style="position:absolute; left:117px; top:131px; width:32px; height:32px;">{{ fittings.ServiceSlot0.type_id|item_image|safe }}</div>
                    <div id="sub2" style="position:absolute; left:147px; top:108px; width:32px; height:32px;">{{ fittings.ServiceSlot1.type_id|item_image|safe }}</div>
                    <div id="sub3" style="position:absolute; left:184px; top:98px; width:32px; height:32px;">{{ fittings.ServiceSlot2.type_id|item_image|safe }}</div>
                    <div id="sub4" style="position:absolute; left:221px; top:107px; width:32px; height:32px;">{{ fittings.ServiceSlot3.type_id|item_image|safe }}</div>
                    <div id="sub5" style="position:absolute; left:250px; top:131px; width:32px; height:32px;">{{ fittings.ServiceSlot4.type_id|item_image|safe }}</div>

                    <div id="bigship" style='position:absolute; left:72px; top:71px; width:256px; height:256px; z-index:-2;'>
                        <img class="img-rounded" src="https://imageserver.eveonline.com/render/{{ structure.type_id }}_256.png" style="height: 256px; width: 256px;">
                    </div>
                </div>
            </div>
            <div class="col-sm-12 col-md-8 text-center">
                <div class="col-sm-12 col-md-12 text-center">
                    <h4>Location</h4>
                    <p><a href="http://evemaps.dotlan.net/system/{{structure.system_name.solarSystemName|slug_dl}}">{{structure.system_name.solarSystemName}}</a>
                        - <a href="http://evemaps.dotlan.net/map/{{structure.system_name.regionName|slug_dl}}/{{structure.system.constellationName}}">{{structure.system_name.constellationName}}</a>
                            - <a href="http://evemaps.dotlan.net/map/{{structure.system_name.regionName|slug_dl}}">{{structure.system_name.regionName}}</a></p>
                </div>
                <div class="col-sm-6 col-md-6 text-center">
                    <h4>Type</h4>
                    <p>{{ structure.type_id|type_name }}</p>
                </div>
                <div class="col-sm-6 col-md-6 text-center">
                    <h4>Owner</h4>
                    <p>{{ structure.corporation.corporation_name }}</p>
                </div>
                <div class="col-sm-12 col-md-12 text-center">
                    <h4>Services</h4>
                    <p>{% for service in structure.services %}
                        {% if service.state == 'online' %}
                            <span class="label label-primary">{{ service.name }}</span>
                        {% else %}
                            <span class="label label-danger">{{ service.name }}</span>
                        {% endif %}
                        {% endfor %}</p>
                </div>

                <div class="col-sm-4 col-md-4 text-center">
                    <h4>Fuel Expires</h4>
                    <p>{{structure.fuel_expires|date:"Y-m-d H:i.s"}}</p>
                </div>
                <div class="col-sm-4 col-md-4 text-center">
                    <h4>Reinforce Time</h4>
                    <p>{{structure.reinforce_hour}}:00</p>
                </div>
                <div class="col-sm-4 col-md-4 text-center">
                    <h4>Reinforce Day</h4>
                    <p>{{structure.reinforce_weekday|reinf_day}}</p>
                </div>

                <div class="col-sm-4 col-md-4 text-center">
                    <h4>Status</h4>
                    <p>{{structure.state|deslug|title}}</p>
                </div>
                <div class="col-sm-4 col-md-4 text-center">
                    <h4>State Timer Start</h4>
                    <p>{% if structure.state_timer_start %}{{structure.state_timer_start|date:"Y-m-d H:i.s"}} {% else %}No Timer{% endif %}</p>
                </div>
                <div class="col-sm-4 col-md-4 text-center">
                    <h4>State Timer End</h4>
                    <p>{% if structure.state_timer_end %}{{structure.state_timer_end|date:"Y-m-d H:i.s"}} {% else %}No Timer{% endif %}</p>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12 col-md-8 text-center col-md-offset-2">
            <h4>Ammo</h4>
            <table id="table-structs" class="table table-hover dataTable">
                <thead>
                    <th class="text-center" style="width: 10%"></th>
                    <th class="text-center" style="width: 70%">Name</th>
                    <th class="text-center" style="width: 20%">Quantity</th>
                </thead>
                <tbody>
                {% for ammo in fittings.Cargo %}
                <tr>
                    <td class="text-center">{{ammo.type_id|item_image|safe}}</td>
                    <td class="text-center">{{ammo.type_id|type_name}}</td>
                    <td class="text-center">{{ammo.quantity}}</td>
                </tr>
                {% empty %}
                <div class="alert alert-info text-center">{% trans "No Ammo." %}</div>
                {% endfor %}
                </tbody>
            </table>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12 col-md-8 text-center col-md-offset-2">
            <h4>Fighters</h4>
            <h5>Tubes</h5>
            <table id="table-structs" class="table table-hover dataTable">
                <thead>
                    <th class="text-center" style="width: 10%"></th>
                    <th class="text-center" style="width: 70%">Name</th>
                    <th class="text-center" style="width: 20%">Tube</th>
                </thead>
                <tbody>
                {% if fittings.FighterTube0 %}
                <tr>
                    <td class="text-center">{{fittings.FighterTube0.type_id|item_image|safe}}</td>
                    <td class="text-center">{{fittings.FighterTube0.type_id|type_name}}</td>
                    <td class="text-center">{{fittings.FighterTube0.location_flag}}</td>
                </tr>
                {% endif %}
                {% if fittings.FighterTube1 %}
                <tr>
                    <td class="text-center">{{fittings.FighterTube1.type_id|item_image|safe}}</td>
                    <td class="text-center">{{fittings.FighterTube1.type_id|type_name}}</td>
                    <td class="text-center">{{fittings.FighterTube1.location_flag}}</td>
                </tr>
                {% endif %}
                {% if fittings.FighterTube2 %}
                <tr>
                    <td class="text-center">{{fittings.FighterTube2.type_id|item_image|safe}}</td>
                    <td class="text-center">{{fittings.FighterTube2.type_id|type_name}}</td>
                    <td class="text-center">{{fittings.FighterTube2.location_flag}}</td>
                </tr>
                {% endif %}
                {% if fittings.FighterTube3 %}
                <tr>
                    <td class="text-center">{{fittings.FighterTube3.type_id|item_image|safe}}</td>
                    <td class="text-center">{{fittings.FighterTube3.type_id|type_name}}</td>
                    <td class="text-center">{{fittings.FighterTube3.location_flag}}</td>
                </tr>
                {% endif %}
                {% if fittings.FighterTube4 %}
                <tr>
                    <td class="text-center">{{fittings.FighterTube4.type_id|item_image|safe}}</td>
                    <td class="text-center">{{fittings.FighterTube4.type_id|type_name}}</td>
                    <td class="text-center">{{fittings.FighterTube4.location_flag}}</td>
                </tr>
                {% endif %}
                </tbody>
            </table>
            <h5>Bay</h5>
            <table id="table-structs" class="table table-hover dataTable">
                <thead>
                    <th class="text-center" style="width: 10%"></th>
                    <th class="text-center" style="width: 70%">Name</th>
                    <th class="text-center" style="width: 20%">Quantity</th>
                </thead>
                <tbody>
                {% for fighter in fittings.FighterBay %}
                <tr>
                    <td class="text-center">{{fighter.type_id|item_image|safe}}</td>
                    <td class="text-center">{{fighter.type_id|type_name}}</td>
                    <td class="text-center">{{fighter.quantity}}</td>
                </tr>
                {% empty %}
                <div class="alert alert-info text-center">{% trans "No Fighters." %}</div>
                {% endfor %}
                </tbody>
            </table>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12 col-md-8 text-center col-md-offset-2">
            <h4>Fuel</h4>
            <table id="table-structs" class="table table-hover dataTable">
                <thead>
                    <th class="text-center" style="width: 10%"></th>
                    <th class="text-center" style="width: 70%">Name</th>
                    <th class="text-center" style="width: 20%">Quantity</th>
                </thead>
                <tbody>
                {% for fuel in fittings.StructureFuel %}
                <tr>
                    <td class="text-center">{{fuel.type_id|item_image|safe}}</td>
                    <td class="text-center">{{fuel.type_id|type_name}}</td>
                    <td class="text-center">{{fuel.quantity}}</td>
                </tr>
                {% empty %}
                <div class="alert alert-info text-center">{% trans "No Fuel." %}</div>
                {% endfor %}
                </tbody>
            </table>
            </div>
        </div>
        <div class="row">
          <div class="panel col-sm-12 col-md-8 col-md-offset-2">
            <div class="panel-heading">
              <h4 class="panel-title text-center">
                <a data-toggle="collapse"href="#fitting">Buy All List</a>
              </h4>
            </div>
            <div id="fitting"class="panel-collapse collapse ">
              <div class="panel-body text-center">
                  <p>{{structure.type_id|type_name}} </br>
                    {% if fittings.LoSlot0 %}{{fittings.LoSlot0.type_id|type_name}}</br>{% endif %}
                    {% if fittings.LoSlot1 %}{{fittings.LoSlot1.type_id|type_name}}</br>{% endif %}
                    {% if fittings.LoSlot2 %}{{fittings.LoSlot2.type_id|type_name}}</br>{% endif %}
                    {% if fittings.LoSlot3 %}{{fittings.LoSlot3.type_id|type_name}}</br>{% endif %}
                    {% if fittings.LoSlot4 %}{{fittings.LoSlot4.type_id|type_name}}</br>{% endif %}
                    {% if fittings.LoSlot5 %}{{fittings.LoSlot5.type_id|type_name}}</br>{% endif %}
                    {% if fittings.LoSlot6 %}{{fittings.LoSlot6.type_id|type_name}}</br>{% endif %}
                    {% if fittings.LoSlot7 %}{{fittings.LoSlot7.type_id|type_name}}</br>{% endif %}
                    {% if fittings.MedSlot0 %}{{fittings.MedSlot0.type_id|type_name}}</br>{% endif %}
                    {% if fittings.MedSlot1 %}{{fittings.MedSlot1.type_id|type_name}}</br>{% endif %}
                    {% if fittings.MedSlot2 %}{{fittings.MedSlot2.type_id|type_name}}</br>{% endif %}
                    {% if fittings.MedSlot3 %}{{fittings.MedSlot3.type_id|type_name}}</br>{% endif %}
                    {% if fittings.MedSlot4 %}{{fittings.MedSlot4.type_id|type_name}}</br>{% endif %}
                    {% if fittings.MedSlot5 %}{{fittings.MedSlot5.type_id|type_name}}</br>{% endif %}
                    {% if fittings.MedSlot6 %}{{fittings.MedSlot6.type_id|type_name}}</br>{% endif %}
                    {% if fittings.MedSlot7 %}{{fittings.MedSlot7.type_id|type_name}}</br>{% endif %}
                    {% if fittings.HiSlot0 %}{{fittings.HiSlot0.type_id|type_name}}</br>{% endif %}
                    {% if fittings.HiSlot1 %}{{fittings.HiSlot1.type_id|type_name}}</br>{% endif %}
                    {% if fittings.HiSlot2 %}{{fittings.HiSlot2.type_id|type_name}}</br>{% endif %}
                    {% if fittings.HiSlot3 %}{{fittings.HiSlot3.type_id|type_name}}</br>{% endif %}
                    {% if fittings.HiSlot4 %}{{fittings.HiSlot4.type_id|type_name}}</br>{% endif %}
                    {% if fittings.HiSlot5 %}{{fittings.HiSlot5.type_id|type_name}}</br>{% endif %}
                    {% if fittings.HiSlot6 %}{{fittings.HiSlot6.type_id|type_name}}</br>{% endif %}
                    {% if fittings.HiSlot7 %}{{fittings.HiSlot7.type_id|type_name}}</br>{% endif %}
                    {% if fittings.RigSlot0 %}{{fittings.RigSlot0.type_id|type_name}}</br>{% endif %}
                    {% if fittings.RigSlot1 %}{{fittings.RigSlot1.type_id|type_name}}</br>{% endif %}
                    {% if fittings.RigSlot2 %}{{fittings.RigSlot2.type_id|type_name}}</br>{% endif %}
                    {% if fittings.ServiceSlot0 %}{{fittings.ServiceSlot0.type_id|type_name}}</br>{% endif %}
                    {% if fittings.ServiceSlot1 %}{{fittings.ServiceSlot1.type_id|type_name}}</br>{% endif %}
                    {% if fittings.ServiceSlot2 %}{{fittings.ServiceSlot2.type_id|type_name}}</br>{% endif %}
                    {% if fittings.ServiceSlot3 %}{{fittings.ServiceSlot3.type_id|type_name}}</br>{% endif %}
                    {% if fittings.ServiceSlot4 %}{{fittings.ServiceSlot4.type_id|type_name}}</br>{% endif %}
                    {% if fittings.ServiceSlot5 %}{{fittings.ServiceSlot5.type_id|type_name}}</br>{% endif %}
                    {% if fittings.ServiceSlot6 %}{{fittings.ServiceSlot6.type_id|type_name}}</br>{% endif %}
                    {% if fittings.ServiceSlot7 %}{{fittings.ServiceSlot7.type_id|type_name}}</br>{% endif %}
                    {% if fittings.FighterTube0 %}{{fittings.FighterTube0.type_id|type_name}}</br>{% endif %}
                    {% if fittings.FighterTube1 %}{{fittings.FighterTube1.type_id|type_name}}</br>{% endif %}
                    {% if fittings.FighterTube2 %}{{fittings.FighterTube2.type_id|type_name}}</br>{% endif %}
                    {% if fittings.FighterTube3 %}{{fittings.FighterTube3.type_id|type_name}}</br>{% endif %}
                    {% if fittings.FighterTube4 %}{{fittings.FighterTube4.type_id|type_name}}</br>{% endif %}
                    {% for ammo in fittings.Cargo %}
                        {{ammo.type_id|type_name}} x{{ammo.quantity}}</br>
                    {% endfor %}
                    {% for fighter in fittings.FighterBay %}
                        {{fighter.type_id|type_name}} x{{fighter.quantity}}</br>
                    {% endfor %}
                    {% for fuel in fittings.StructureFuel %}
                        {{fuel.type_id|type_name}} x{{fuel.quantity}}</br>
                    {% endfor %}
                  </p>
              </div>
            </div>
          </div>
        </div>
        {% if notification_pings %}
            <div class="row">
              <div class="panel col-sm-12 col-md-8 col-md-offset-2">
                <div class="panel-heading">
                  <h4 class="panel-title text-center">
                    <a data-toggle="collapse"href="#notifs">Structure Notification History</a>
                  </h4>
                </div>
                <div id="notifs"class="panel-collapse collapse ">
                    <table class="table table-hover">
                        <thead>
                            <th>Date</th>
                            <th>Title</th>
                            <th>Detail</th>
                        </thead>
                        {% for note in notification_pings %}
                        {% with notejson=note.get_json %}
                        <tr>
                            <td>{{note.time|date:"Y-m-d H:i"}}</td>
                            <td>{{notejson.description}}</td>
                            <td>
                        {% for notej in notejson.fields %}
                                <p>{{ notej.name }}: {{ notej.value }}</p>
                        {% endfor %}
                            </td>
                        </tr>
                        {% endwith %}
                        {% endfor %}
                    </table>
                </div>
              </div>
            </div>
        {% endif %}

    {% else %}
    <div class="alert alert-warning text-center">{% trans "No Structure." %}</div>
    {% endif %}

{% endblock %}
